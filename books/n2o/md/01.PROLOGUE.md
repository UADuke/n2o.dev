## Пролог

Цей посібник виник як результат тривалої розробки дуже простої бібліотеки N2O,
яка набула деякої популярності завдяки своєму прагненню до мінімальності (700 рядків на мові Erlang).
Після апробації Erlang платформи уцілому було прийнято рішення
будувати майбутню систему автоматизації підприємста ERP.UNO на цій основі.

### 01-01 Мотивація: створення модулів підприємства ERP.UNO

N2O сервер, а також NITRO веб-фреймворк були створенні як інструментільні засоби
для створення промислових ERP модулів підприємства у складі відкритої платформи ERP.UNO.
Напочатку, N2O був створений, як оптимізована версія веб-фреймворку Nitrogen,
створеного Расті Клопгаузом. Хотілося створити оптимальний високонадійний мінімізований
WebSocket-тракт, який не містить синхронного протоколу HTTP взагалі та дозволяє
створювати повноцінні асинхронні веб-додатки реального часу. На ньому була створена система
управління депозитами в національному банку ПриватБанк.
Пізніше N2O був розділений на бібліотеку-фреймворк процесів та протоколів (власне N2O) та
бібліотеку-веб-фреймворк NITRO. Бібліотеки N2O та NITRO також отримали можливість роботи
не тільки через WebSocket але і через MQTT та через чисті TCP або UDP. Така оновлена версія
була впроваджена як ядро системи повідомлень для додатку NYNJA з відкритим open-source протоколом.

### 01-02 Призначення: програмний стек вищих рівнів моделі OSI

Для запезпечення повноцінної промислової специфікації ERP.UNO,
ми розширили набір інструментальних засобів наступними бібліотеками:
формальними представленнями презентаційного рівня FORM та системою управління бізнес-процесів BPE.
FORM представляє собою декларативну бібліотеку побудови графічних інтерфейсів,
а бібліотека BPE підтримує XML файли стандарту BPMN 2.0 та реалізує
безпосередню інтерналізацію BPMN семантики у семантику віртуальної машини Erlang.

### 01-03 Формальне визначення

Концептуальна модель системи в рамках якої функціонує N2O визначаена просто як
обчислювальне середовище, яке складається з процесору подій (N2O),
операційного (ETS) та персистентного сховища (KVS).
З точки зору обчислювального середовища, ресурси підприємства складаються
з глобального сховища та з обчислень які розділяють глобальну адресацію представляють
собою Erlang-процеси (N2O протоколи).
Кожен процес PI може містити певний набір протоколів, будь-який з яких відповідає на певний набір повідомлень.
Протоколи N2O визначені на точці підключення повинні не перетинатия, в іншому випадку протокольні
модулі можуть перехоплювати та впливати на інші протокольні модулі, які повинні реагувати
на той самий тип повідомлень.

```
config :n2o,
  tables: [:cookies, :file, :caching, :ws, :mqtt, :tcp, :async],
  protocols: [:bpe_n2o, :nitro_n2o, :n2o_ftp, :n2o_heart],
```

Так, змінна N2O, `tables` містить перелік ETS таблиць віртуальної машини Erlang необхідних
у якості операційних таблиць відповідних сервісів. Змінна `protocols` містить ланцюжок протоколів N2O,
який за замовчуванням буде присутнім на кожній конкретній точкі підключення.

#### Обчислювальні ресурси N2O процеси PI

Усі PI процеси запускаються під головним супервізором N2O.

```elixir
> :supervisor.which_children(:n2o)
[
  {{:ws, '/chat/ws/4'}, #PID<0.985.0>, :worker, [:n2o_ws]},
  {{:ws, '/chat/ws/3'}, #PID<0.984.0>, :worker, [:n2o_ws]},
  {{:ws, '/chat/ws/2'}, #PID<0.983.0>, :worker, [:n2o_ws]},
  {{:ws, '/chat/ws/1'}, #PID<0.982.0>, :worker, [:n2o_ws]},
  {{:mqtt, '/erp/mqtt/4'}, #PID<0.977.0>, :worker, [:n2o_mqtt]},
  {{:mqtt, '/erp/mqtt/3'}, #PID<0.976.0>, :worker, [:n2o_mqtt]},
  {{:mqtt, '/erp/mqtt/2'}, #PID<0.975.0>, :worker, [:n2o_mqtt]},
  {{:mqtt, '/erp/mqtt/1'}, #PID<0.974.0>, :worker, [:n2o_mqtt]},
  {{:mqtt, '/bpe/mqtt/4'}, #PID<0.977.0>, :worker, [:n2o_mqtt]},
  {{:mqtt, '/bpe/mqtt/3'}, #PID<0.976.0>, :worker, [:n2o_mqtt]},
  {{:mqtt, '/bpe/mqtt/2'}, #PID<0.975.0>, :worker, [:n2o_mqtt]},
  {{:mqtt, '/bpe/mqtt/1'}, #PID<0.974.0>, :worker, [:n2o_mqtt]},
  {{:caching, 'timer'}, #PID<0.969.0>, :worker, [:n2o]}
]
```

#### Персистентні ресурси KVS

Для відображення усіх таблиць (префіксів) які існують в глобальному просторі ключів,
скористайтеся системним фідом `writer`.

```elixir
> :kvs.all :writer
[
  {:writer, '/bpe/proc', 2, [], [], []},
  {:writer, '/erp/group', 1, [], [], []},
  {:writer, '/erp/partners', 7, [], [], []},
  {:writer, '/acc/synrc/Kyiv', 3, [], [], []},
  {:writer, '/chat/5HT', 1, [], [], []},
  {:writer, '/bpe/hist/1562187187807717000', 16, [], [], []},
  {:writer, '/bpe/hist/1562192587632329000', 1, [], [], []}
]
```

### 01-04 Структура організації: N2O BPE KVS NITRO FORM MQTT

Структура бібліотек які реалізують фундацію N2O.DEV (організація SYNRC) для системи управління підприємствами ERP.UNO (організація ERPUNO):

* KVS &mdash; персистентна пам'ять з глобальний простором ключів
* N2O &mdash; сервер процесів та протоколів який реалізує кеш, сесійні змінні засобами ETS, та кодування засобами AES GCM.
* BPE &mdash; сисема управління процесами стандарту BPMN 2.0
* NITRO &mdash; веб-фреймворк Nitrogen
* FORM &mdash; бібліотека декларативного конструювання інтерфейсів

Цей посібник більше присвячений бібліотекам N2O та NITRO, та лише незначним чином торкається сховища даних KVS.
